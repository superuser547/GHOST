# Бэкенд (FastAPI)

Это серверная часть проекта GHOST, реализованная на FastAPI.
В дальнейшем бэкенд будет отвечать за генерацию отчётов по ГОСТ/МИСИС и работу с данными.
Сейчас реализован только минимальный эндпоинт проверки состояния.

Доменные модели начинаются с `ReportMeta` в `app/models/report.py`.
Там же определён базовый блок `BaseBlock`, который будет расширяться специализированными типами.

## Требования к окружению

- Python 3.11+
- Установленный `pip`

## Установка зависимостей

```bash
cd backend
python -m venv .venv
# Windows:
.venv\Scripts\activate
# macOS / Linux:
source .venv/bin/activate

pip install --upgrade pip
pip install -r requirements.txt
```

## Запуск сервера разработки

После активации виртуального окружения:

```bash
uvicorn app.main:app --reload --port 8000
```

- Приложение будет доступно по адресу `http://localhost:8000/health`.
- Swagger-документация появится по адресу `http://localhost:8000/docs`.

## Требования и спецификация

Подробное функциональное и техническое описание проекта см. в корневом файле [REQUIREMENTS.md](../REQUIREMENTS.md).

## Проверка кода и форматирование

Для разработки рекомендуется использовать `black` и `ruff`.

Установка dev-зависимостей:

```bash
cd backend
# виртуальное окружение уже должно быть активировано
pip install -r requirements-dev.txt
```

Запуск форматтера:

```bash
cd backend
black app
```

Запуск линтера:

```bash
cd backend
ruff check app
```

## Структура данных и файл проекта

Основной моделью данных на стороне бэкенда является `Report` (`app.models.Report`):

- `meta: ReportMeta` — метаданные отчёта (тип работы, номер, дисциплина, тема, студент, группа, преподаватель, дата сдачи и т.д.).
- `blocks: List[ReportBlock]` — упорядоченный список блоков отчёта (разделы, подразделы, текст, списки, таблицы, рисунки, приложения и т.д.).

Файл проекта (например, для сохранения/загрузки на фронтенде) — это JSON-сериализация модели `Report`.

Пример (упрощённый) JSON-файла проекта:

```json
{
  "meta": {
    "preset": "misis_v1",
    "work_type": "practice",
    "work_number": 1,
    "discipline": "Технологические основы производства",
    "topic": "Построение технологической схемы производства",
    "student_full_name": "Иванов Иван Иванович",
    "group": "ББИ-24-3",
    "semester": "2",
    "direction_code": "38.03.05",
    "direction_name": "Бизнес-информатика",
    "department": "Кафедра бизнес-информатики",
    "teacher_full_name": "Петров Петр Петрович",
    "submission_date": "2025-03-15"
  },
  "blocks": [
    {
      "id": "UUID...",
      "type": "section",
      "title": "ВВЕДЕНИЕ",
      "special_kind": "INTRO",
      "children": [
        {
          "id": "UUID...",
          "type": "text",
          "text": "Это пример простого текста во введении.",
          "children": []
        }
      ]
    }
  ]
}
```

Именно такой формат будет использоваться:

- для обмена данными между фронтендом и бэкендом;
- для сохранения проектов на диск (файл `.report.json` или аналогичный).

## Тесты

Для запуска тестов:

```bash
cd backend
# убедиться, что виртуальное окружение активно и зависимости установлены:
# pip install -r requirements.txt
# pip install -r requirements-dev.txt
pytest
```
